{% extends "users/header.html" %}

{% block content %}

{% include 'users/includes/messages.html' %}

<!-- Device Permissions Detail-->
<div class="container-fluid">
    <div class="row d-flex justify-content-center align-items-center min-vh-75">
        <div class="col-md-10 bg-white p-5">

            <h1>Edit Device Permissions</h1>
            <form id="device_perms_form" action="" method="post">
                {% csrf_token %}
                <table class="table">
                    <tr>
                        <td><b>Device:</b></td>
                        <td><b>{{ device.name }}</b></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td><b>Description:</b></td>
                        <td>{{ form.summary }}</td>
                        <td>Device description.</td>
                    </tr>
                </table>
                <button type="submit" class="btn btn-secondary btn-sm" name="save">Save</button>
                <hr />
                <button type="submit" class="btn btn-secondary btn-sm" name="token">Generate MQTT Token</button>
                <div class="form-group">
                    <label for="token_username">MQTT Username: </label>
                    <input id="token_username" name="token_username" class="form-control"></textarea>
                </div>
                <div class="form-group">
                    <label for="token_password">MQTT Password: </label>
                    <textarea id="token_password" name="token_password" class="form-control" rows="4"
                        cols="50"></textarea>
                    <small id="tokenHelp" class="form-text text-muted">Keep this MQTT token safe on your device, and do
                        not share it with anyone.</small>
                </div>
                <hr />
                <input type="button" class="btn btn-danger btn-sm" onclick="clickDelete(this);" value="Delete Device" />
            </form>

        </div>
    </div>
    <script>
        async function clickDelete() {
            Swal.fire({
                title: 'Are you sure you want to delete device {{ device.name }}?',
                showCancelButton: true,
                confirmButtonText: `Yes`,
                customClass: {
                    cancelButton: 'order-1 right-gap',
                    confirmButton: 'order-2',
                }
            }).then((result) => {
                if (result.isConfirmed) {
                    // submit delete in form manually
                    const form = document.getElementById('device_perms_form');
                    const input = document.createElement('input');
                    input.setAttribute('name', 'delete');
                    form.appendChild(input);
                    form.submit();
                }
            })
        }
    </script>
</div>

{{ form.media }}

{% endblock content %}
