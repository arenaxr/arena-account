{% extends "users/header.html" %}

{% block extrahead %}
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/@ttskch/select2-bootstrap4-theme@x.x.x/dist/select2-bootstrap4.min.css">
{% endblock extrahead %}

{% block content %}

{% include 'users/includes/messages.html' %}

<!-- Scene Permissions Detail-->
<div class="container-fluid">
    <div class="row d-flex justify-content-center align-items-center">
        <div class="col-lg-8 col-md-8 shadow rounded bg-white p-5">

            <h1>Edit Scene Permissions</h1>
            <form action="" method="post">
                {% csrf_token %}
                <table class="table">
                    <tr>
                        <td><b>Scene:</b></td>
                        <td><b>{{ scene.name }}</b></td>
                        <td></td>
                    </tr>
                    <tr>
                        <td><b>Public Read:</b></td>
                        <td>{{ form.public_read }}</td>
                        <td>Allow any user to view the scene (default: on).</td>
                    </tr>
                    <tr>
                        <td><b>Public Write:</b></td>
                        <td>{{ form.public_write }}</td>
                        <td>Allow any user to edit the scene (default: off).</td>
                    </tr>
                    <tr>
                        <td><b>Anonymous Users:</b></td>
                        <td>{{ form.anonymous_users }}</td>
                        <td>Allow anonymous users to connect to the scene (default: on).</td>
                    </tr>
                    <tr>
                        <td><b>Video Conferencing:</b></td>
                        <td>{{ form.video_conference }}</td>
                        <td>Allow users to video conference (default: on).</td>
                    </tr>
                    <tr>
                        <td><b>Editors:</b></td>
                        <td>{{ form.editors }}</td>
                        <td>Select/deselect specific editors.<br>Autocompletes on valid usernames.<br>Clear all: right x. Clear one: left x on left side of username.</td>
                    </tr>
                </table>
                <button type="submit" class="btn btn-primary btn-sm" name="save">Save</button>
                <button type="submit" class="btn btn-primary btn-sm" name="delete"
                    onclick="return confirm('Are you sure you want to delete {{ scene.name }}?');">Delete</button>
                <a href="{{request.scheme}}://{{request.get_host}}/build/?scene={{ scene.name }}"
                    class="btn btn-primary btn-sm">Edit Scene Objects</a>
            </form>

        </div>
    </div>
</div>

{{ form.media }}

<script>
    (function($) {
        $('#add-form').click(function() {
            var index = $('#id_inline_test_models-TOTAL_FORMS').val()
            var newTable = $('#id_inline_test_models-__prefix__-DELETE').parents('table').clone()
            newTable.find(':input').each(function() {
                for (attr of ['username', 'id'])
                    $(this).attr(
                        attr,
                        $(this).attr(attr).replace('__prefix__', index)
                    )
            })
            newTable.insertBefore($(this))
            $('#id_inline_test_models-TOTAL_FORMS').val(
                parseInt($('#id_inline_test_models-TOTAL_FORMS').val()) + 1
            )
            newTable.slideDown()
        })
    })($)
</script>

{% endblock content %}
